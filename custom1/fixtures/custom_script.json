[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Journal Entry", 
  "modified": "2019-04-07 11:29:40.328550", 
  "name": "Journal Entry-Client", 
  "script": "frappe.ui.form.on(\"Journal Entry\", \"validate\", function(frm, cdt, cdn) {\n\tfrm.script_manager.trigger(\"voucher_type\");\n\tif (frm.doc.voucher_type == \"Cash Entry\" || frm.doc.voucher_type == \"Bank Entry\"){\n\t\tfrm.doc.accounts = [];\t\n\t\ttotal_debit = 0;\n\t\t$.each(frm.doc.expenses, function(i, r){ \n\t\t\tif (!r.account_description)r.account_description=\"\";\n\t\t\trow = frm.add_child(\"accounts\");\n\t\t\trow.account = r.account_code;\n\t\t\trow.account_description = r.account_description;\n\t\t\tif (r.account_description)frm.doc.user_remark += r.account_description + \"#\";\n\t\t\trow.debit_in_account_currency = r.amount;\n\t\t\ttotal_debit += r.amount;\n\t\t\trow.cost_center = r.cost_center;\n\t\t});\n\t\tconsole.log('total_debit == ' + total_debit);\n\t\trow = frm.add_child(\"accounts\");\n\t\trow.account = frm.doc.cash_bank_account;\n\t\trow.credit_in_account_currency = total_debit;\n\t}\n});\nfrappe.ui.form.on(\"Journal Entry\", \"onload_post_render\", function(frm, cdt, cdn) {\n\tfrm.fields_dict['cash_bank_account'].get_query = function(frm, cdt, cdn) {\n\t\tconsole.log('trigger query cash_bank_account');\n\t\td = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters:[\n\t\t\t\t\t\t['account_type', 'in', ['Cash','Bank']],\n\t\t\t\t\t\t['is_group', '=', '0'],\n\t\t\t\t\t\t['freeze_account', '=', 'No']\n\t\t\t\t\t]\n\t\t\t}\n\t}\n\tfrm.fields_dict.expenses.grid.wrapper.on('focus', 'input[data-fieldname=\"account_code\"][data-doctype=\"Journal Entry Expenses\"]', function(e){\n\t\tvar current_doc = $('.data-row.editable-row').parent().attr(\"data-name\");\n        \tvar d = locals[\"Journal Entry Expenses\"][current_doc];\n\t\t//refresh_field(\"references\");\n\t\tfrm.fields_dict['expenses'].grid.get_field('account_code').get_query = function(frm, cdt, cdn) {\t\n\t\t\tvar d = locals[cdt][cdn];\n\t\t\tconsole.log('trigger set query for account 1');\n\t\t\t//if (d.reference_doctype == \"Sales Invoice\"){\t\t\n\t\t\t\treturn {\n\t\t\t\t\tfilters:[\n\t\t\t\t\t\t['root_type', '=', 'Expense'],\n\t\t\t\t\t\t['is_group', '=', '0'],\n\t\t\t\t\t\t['freeze_account', '=', 'No']\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t//}\n\t\t}\n\t})\n\tfrm.fields_dict['expenses'].grid.get_field('account_code').get_query = function(frm, cdt, cdn) {\t\n\t\tvar d = locals[cdt][cdn];\n\t\tconsole.log('trigger set query for account 2');\n\t\t//if (d.reference_doctype == \"Sales Invoice\"){\t\t\n\t\t\treturn {\n\t\t\t\tfilters:[\n\t\t\t\t\t['root_type', '=', 'Expense'],\n\t\t\t\t\t['is_group', '=', '0'],\n\t\t\t\t\t['freeze_account', '=', 'No']\n\t\t\t\t]\n\t\t\t}\n\t\t//}\n\t}\n});\nfrappe.ui.form.on(\"Journal Entry\", \"voucher_type\", function(frm, cdt, cdn) {\n\tif (frm.doc.voucher_type == \"Cash Entry\" || frm.doc.voucher_type == \"Bank Entry\"){\n\t\tfrm.set_df_property(\"sc_expenses\",\"hidden\",false);\n\t\tfrm.set_df_property(\"accounts\",\"hidden\",1);\n\t\t//frm.doc.accounts = [];\n\t}\n\telse {\n\t\tfrm.doc.expenses = [];\n\t\tfrm.doc.cash_bank_account = \"\";\n\t\tfrm.set_df_property(\"sc_expenses\",\"hidden\",true);\n\t\tfrm.set_df_property(\"accounts\",\"hidden\",0);\n\t}\n});\nfrappe.ui.form.on(\"Journal Entry\", \"refresh\", function(frm, cdt, cdn) {\n\t//if (frm.doc.user_remark)frm.doc.user_remark = \"\";\n\tfrm.script_manager.trigger(\"voucher_type\");\n\t$.each(frm.doc.accounts, function(i, r){ \t\n\t\t//if (r.account_description)frm.doc.user_remark = frm.doc.user_remark.replace(undefined,\"\") + \"#\" + r.account_description +\"#\";\n\t\t//if (frappe.session.user.indexOf('kasirkrekot') > -1) r.cost_center = \"Retail Krekot - DUN\";\n\t\tif (frappe.session.user.indexOf('bengkel') > -1) r.cost_center = \"Workshop Millenium - DUN\";\n\t});\n});\nfrappe.ui.form.on(\"Journal Entry Account\", \"account\", function(frm, cdt, cdn) {\n\t//if (frm.doc.user_remark)frm.doc.user_remark = \"\";\n\td = locals[cdt][cdn];\n\t//if (frappe.session.user.indexOf('kasir') > -1)\n\tfrappe.model.set_value(cdt,cdn,\"cost_center\",\"\");\n});", 
  "script_type": "Client"
 }
]